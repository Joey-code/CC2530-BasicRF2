
******************************************************/

// INCLUDES
//
#include <hal_assert.h>
#include <hal_board.h>
#include "JLX12864.h"
#include <hal_int.h>
#include "hal_mcu.h"
#include "hal_rf.h"
#include "basic_rf.h"
#include<stdio.h>

/***********************************************************************************
* CONSTANTS
*/
#define RF_CHANNEL                25      // 2.4 GHz RF channel
#define PAN_ID                0x2007
#define ADDR                  0x2520
#define APP_PAYLOAD_LENGTH        1

/***********************************************************************************/

static uint8 pRxData[APP_PAYLOAD_LENGTH];
static uint8 pTxData[APP_PAYLOAD_LENGTH];
static basicRfCfg_t basicRfConfig;
 uchar v;
uint16 count=0;
char hello[] ="<G>你好,欢迎使用";

//纵向字节倒序
uchar dang[]={
0x00,0x10,0x12,0x14,0x18,0x10,0x10,0x1F,0x10,0x10,0x18,0x14,0xF2,0x00,0x00,0x00,
0x10,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x11,0x3F,0x00,0x00
};

/*--  文字:  前  --*/
uchar qian[]={
0x00,0x04,0xF4,0x95,0x96,0x94,0x94,0xF4,0x04,0xE4,0x06,0x05,0xF4,0x04,0x00,0x00,
0x00,0x3F,0x04,0x04,0x24,0x24,0x3F,0x00,0x07,0x20,0x20,0x3F,0x00,0x00
};

/*--  文字:  时  --*/
char shi[]={
0x00,0xFC,0x44,0x44,0xFC,0x00,0x08,0x48,0x88,0x08,0x08,0xFF,0x08,0x08,0x00,0x00,
0x0F,0x04,0x04,0x0F,0x00,0x00,0x00,0x01,0x20,0x20,0x3F,0x00,0x00,0x00
};

/*--  文字:  速  --*/
char su[]={
0x00,0x40,0x42,0xCC,0x00,0x04,0xF4,0x94,0x94,0xFF,0x94,0x94,0xF4,0x04,0x00,0x00,
0x20,0x10,0x0F,0x10,0x28,0x24,0x22,0x21,0x3F,0x21,0x22,0x24,0x28,0x00
};


uchar jin[]={
0x00,0x40,0x40,0x20,0x10,0x08,0x14,0x63,0x04,0x08,0x10,0x20,0x40,0x40,0x00,0x00,
0x00,0x00,0x01,0x01,0x01,0x01,0x21,0x11,0x0D,0x03,0x00,0x00,0x00,0x00
};

/*--  文字:  天  --*/
uchar tian[]={
0x00,0x40,0x42,0x42,0x42,0x42,0x42,0xFE,0x42,0x42,0x42,0x42,0x42,0x40,0x00,0x00,
0x20,0x20,0x10,0x08,0x04,0x03,0x00,0x03,0x04,0x08,0x10,0x20,0x20,0x00
};

/*--  文字:  气  --*/
uchar qi[]={
0x00,0x10,0x48,0x47,0x54,0x54,0x54,0x54,0x54,0x54,0x54,0xD4,0x04,0x04,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x10,0x38,0x00
};

/*--  文字:  是  --*/
uchar shi1[]={
0x00,0x40,0x40,0x5F,0x55,0x55,0x55,0xD5,0x55,0x55,0x55,0x5F,0x40,0x40,0x00,0x00,
0x20,0x10,0x0F,0x10,0x20,0x20,0x3F,0x22,0x22,0x22,0x22,0x20,0x20,0x00
};

/*--  文字:  晴  --*/
uchar qing[]={
0x00,0xFC,0x44,0x44,0xFC,0x20,0xAA,0xAA,0xAA,0xBF,0xAA,0xAA,0xAA,0x20,0x00,0x00,
0x0F,0x04,0x04,0x0F,0x00,0x3F,0x0A,0x0A,0x0A,0x2A,0x2A,0x3F,0x00,0x00
};


/*--  文字:  国  --*/
uchar guo[]={
0x00,0x00,0xFF,0x01,0x05,0x25,0x25,0xFD,0x25,0xA5,0x25,0x05,0x01,0xFF,0x00,0x00,
0x00,0x3F,0x10,0x12,0x12,0x12,0x13,0x12,0x12,0x13,0x12,0x10,0x3F,0x00
};

/*--  文字:  内  --*/
uchar nei[]={
0x00,0x00,0xF8,0x08,0x08,0x88,0x48,0x3F,0x48,0x88,0x08,0x08,0x08,0xF8,0x00,0x00,
0x00,0x3F,0x02,0x01,0x00,0x00,0x00,0x00,0x00,0x01,0x22,0x20,0x3F,0x00
};

/*--  文字:  消  --*/
uchar xiao[]={
0x00,0x20,0x42,0x04,0x88,0x00,0xF2,0x94,0x90,0x9F,0x90,0x94,0xF2,0x00,0x00,0x00,
0x00,0x18,0x06,0x01,0x00,0x3F,0x04,0x04,0x04,0x24,0x24,0x3F,0x00,0x00
};

/*--  文字:  息  --*/
uchar xi[]={
0x00,0x00,0x00,0xFC,0x54,0x56,0x55,0x54,0x54,0x54,0x54,0xFC,0x00,0x00,0x00,0x00,
0x20,0x18,0x01,0x1D,0x21,0x21,0x23,0x2D,0x21,0x31,0x01,0x04,0x18,0x00
};

/*--  文字:  有  --*/
uchar you[]={
0x00,0x84,0x44,0x24,0xF4,0x9C,0x97,0x94,0x94,0x94,0x94,0xF4,0x04,0x04,0x00,0x00,
0x00,0x00,0x00,0x3F,0x04,0x04,0x04,0x04,0x24,0x24,0x3F,0x00,0x00,0x00
};

/*****************************************
 串口初始化函数：初始化串口 UART0		
*****************************************/
void InitUART0(void)
{
{
    CLKCONCMD &= ~0x40; // 设置系统时钟源为 32MHZ晶振
    while(CLKCONSTA & 0x40);                     // 等待晶振稳定 
    CLKCONCMD &= ~0x47;                          // 设置系统主时钟频率为 32MHZ

    PERCFG = 0x00;        //位置1 P0口 
    P0SEL |= 0x0c;        //P0_2,P0_3,P0_4,P0_5用作串口,第二功能 
    P2DIR &= ~0XC0;      //P0 优先作为UART0 ，优先级
 
    U0CSR |= 0x80;       //UART 方式 
    U0GCR |= 8;         //U0GCR与U0BAUD配合     
    U0BAUD |= 59;       // 波特率设为115200 
    UTX0IF = 0;          //UART0 TX 中断标志初始置位1  （收发时候）
    U0CSR |= 0X40;       //允许接收 
    IEN0 |= 0x84;        // 开总中断，接收中断    
}			  //开总中断，接收中断

}

/****************************************************************
   串口发送字符串函数						
****************************************************************/
void UartTX_Send_String(char *Data,int len)
{
  int j;
  for(j=0;j<len;j++)
  {
    U0DBUF = *Data++;
    while(UTX0IF == 0);
    UTX0IF = 0;
  }
     U0DBUF = 0x0A;        // 换行
    while(UTX0IF == 0);
      UTX0IF = 0;
}

void Key()
{
  if(KEY1==0)
  {        
      Red_LED=!Red_LED;

      UartTX_Send_String(hello,16);
      halMcuWaitMs(300);     //按键去抖
       display_graphic_16x16(2,1,dang);
      display_graphic_16x16(2,15,qian);
        display_graphic_16x16(2,30,shi);
         display_graphic_16x16(2,45,su);

 //  LCD_write_english_string(2,1,"warm!! velocity is ");  //显示字符串
      LCD_write_english_string(2,100,"km/h");  //显示
  } 
  if(KEY2==0)
  {        
      Yellow_LED=!Yellow_LED;
 UartTX_Send_String("S2 detected",11);
      
  halMcuWaitMs(300);     //按键去抖
    //  LCD_write_english_string(4,1,"Today is sunny ");  //显示字符串
  display_graphic_16x16(4,1,jin);
      display_graphic_16x16(4,15,tian);
        display_graphic_16x16(4,30,tian);
         display_graphic_16x16(4,45,qi); 
  display_graphic_16x16(4,60,shi1);
      display_graphic_16x16(4,75,qing); 
}
  if(KEY3==0)
  {        
      Blue_LED=!Blue_LED;
      UartTX_Send_String("S3 detected",11);
      halMcuWaitMs(300);     //按键去抖
   //   LCD_write_english_string(5,1,"The New is...  ");  //显示字符串
display_graphic_16x16(6,1,guo);
      display_graphic_16x16(6,15,nei);
        display_graphic_16x16(6,30,xiao);
         display_graphic_16x16(6,45,xi); 
  display_graphic_16x16(6,60,you);
   LCD_write_english_string(6,75,"...... ");  //显示字
} 
}

void main(void)
{
    // Config basicRF
    basicRfConfig.panId = PAN_ID;
    basicRfConfig.channel = RF_CHANNEL;
    basicRfConfig.ackRequest = TRUE;
    basicRfConfig.myAddr = ADDR; 
    
    halBoardInit();   //初始化单片机
    Initial_IO();     //初始化IO   
    initial_lcd();
    clear_screen();      //clear all dots
    LCD_write_english_string(1,1,"    Welcome  ");  //显示英文字符串
    halMcuWaitMs(100);  // 延时100毫秒
    InitUART0();
   

    if(halRfInit()==FAILED) {
      HAL_ASSERT(FALSE);
    }    
    if(basicRfInit(&basicRfConfig)==FAILED) {
      HAL_ASSERT(FALSE);
    }   
   
    basicRfReceiveOn();   //开接收
    
       while (1) 
       {        
        if (basicRfPacketIsReady())   // receive data
        {   
          if(basicRfReceive(pRxData, APP_PAYLOAD_LENGTH, NULL)>0)
          {    
           
                Blue_LED=!Blue_LED;
                    v=pRxData[0]-0x30;
                   LCD_disp_char(2,61,v);  //显示英文字符串
             
            }
          }
               
        Key();
        halMcuWaitMs(1);  // 延时1毫秒         
    }
    
}


